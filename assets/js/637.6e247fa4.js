(window.webpackJsonp=window.webpackJsonp||[]).push([[637],{1114:function(t,a,n){"use strict";n.r(a);var s=n(14),e=Object(s.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"_13-2-运行时异常和-panic"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_13-2-运行时异常和-panic"}},[t._v("#")]),t._v(" 13.2 运行时异常和 panic")]),t._v(" "),a("p",[t._v("当发生像数组下标越界或类型断言失败这样的运行错误时，Go 运行时会触发"),a("em",[t._v("运行时 panic")]),t._v("，伴随着程序的崩溃抛出一个 "),a("code",[t._v("runtime.Error")]),t._v(" 接口类型的值。这个错误值有个 "),a("code",[t._v("RuntimeError()")]),t._v(" 方法用于区别普通错误。")]),t._v(" "),a("p",[a("code",[t._v("panic()")]),t._v(" 可以直接从代码初始化：当错误条件（我们所测试的代码）很严苛且不可恢复，程序不能继续运行时，可以使用 "),a("code",[t._v("panic()")]),t._v(" 函数产生一个中止程序的运行时错误。"),a("code",[t._v("panic()")]),t._v(" 接收一个做任意类型的参数，通常是字符串，在程序死亡时被打印出来。Go 运行时负责中止程序并给出调试信息。在示例 13.2 "),a("a",{attrs:{href:"examples/chapter_13/panic.go"}},[t._v("panic.go")]),t._v(" 中阐明了它的工作方式：")]),t._v(" "),a("div",{staticClass:"language-go extra-class"},[a("pre",{pre:!0,attrs:{class:"language-go"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("package")]),t._v(" main\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"fmt"')]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("main")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\tfmt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Starting the program"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("panic")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"A severe error occurred: stopping the program!"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\tfmt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Ending the program"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("输出如下：")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Starting the program\npanic: A severe error occurred: stopping the program!\npanic PC=0x4f3038\nruntime.panic+0x99 /go/src/pkg/runtime/proc.c:1032\n       runtime.panic(0x442938, 0x4f08e8)\nmain.main+0xa5 E:/Go/GoBoek/code examples/chapter 13/panic.go:8\n       main.main()\nruntime.mainstart+0xf 386/asm.s:84\n       runtime.mainstart()\nruntime.goexit /go/src/pkg/runtime/proc.c:148\n       runtime.goexit()\n---- Error run E:/Go/GoBoek/code examples/chapter 13/panic.exe with code Crashed\n---- Program exited with code -1073741783\n")])])]),a("p",[t._v("一个检查程序是否被已知用户启动的具体例子：")]),t._v(" "),a("div",{staticClass:"language-go extra-class"},[a("pre",{pre:!0,attrs:{class:"language-go"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" user "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" os"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Getenv")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"USER"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("check")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" user "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("panic")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Unknown user: no value for $USER"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("可以在导入包的 "),a("code",[t._v("init()")]),t._v(" 函数中检查这些。")]),t._v(" "),a("p",[t._v("当发生错误必须中止程序时，"),a("code",[t._v("panic()")]),t._v(" 可以用于错误处理模式：")]),t._v(" "),a("div",{staticClass:"language-go extra-class"},[a("pre",{pre:!0,attrs:{class:"language-go"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" err "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("nil")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("panic")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ERROR occurred:"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" err"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Error")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[a("u",[t._v("Go panicking")]),t._v("：")]),t._v(" "),a("p",[t._v("在多层嵌套的函数调用中调用 "),a("code",[t._v("panic()")]),t._v("，可以马上中止当前函数的执行，所有的 "),a("code",[t._v("defer")]),t._v(" 语句都会保证执行并把控制权交还给接收到 panic 的函数调用者。这样向上冒泡直到最顶层，并执行（每层的） "),a("code",[t._v("defer")]),t._v("，在栈顶处程序崩溃，并在命令行中用传给 "),a("code",[t._v("panic()")]),t._v(" 的值报告错误情况：这个终止过程就是 "),a("em",[t._v("panicking")]),t._v("。")]),t._v(" "),a("p",[t._v("标准库中有许多包含 "),a("code",[t._v("Must")]),t._v(" 前缀的函数，像 "),a("code",[t._v("regexp.MustComplie()")]),t._v(" 和 "),a("code",[t._v("template.Must()")]),t._v("；当正则表达式或模板中转入的转换字符串导致错误时，这些函数会 "),a("code",[t._v("panic()")]),t._v("。")]),t._v(" "),a("p",[t._v("不能随意地用 "),a("code",[t._v("panic()")]),t._v(" 中止程序，必须尽力补救错误让程序能继续执行。")]),t._v(" "),a("h2",{attrs:{id:"链接"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#链接"}},[t._v("#")]),t._v(" 链接")]),t._v(" "),a("ul",[a("li",[a("RouterLink",{attrs:{to:"/the-way-to-go/directory.html"}},[t._v("目录")])],1),t._v(" "),a("li",[t._v("上一节："),a("RouterLink",{attrs:{to:"/the-way-to-go/13.1.html"}},[t._v("错误处理")])],1),t._v(" "),a("li",[t._v("下一节："),a("RouterLink",{attrs:{to:"/the-way-to-go/13.3.html"}},[t._v("从 panic 中恢复 (recover)")])],1)])])}),[],!1,null,null,null);a.default=e.exports}}]);