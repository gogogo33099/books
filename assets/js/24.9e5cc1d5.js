(window.webpackJsonp=window.webpackJsonp||[]).push([[24],{337:function(t,s,a){t.exports=a.p+"assets/img/ch5-online-group.9a7ce70b.png"},338:function(t,s){t.exports="data:image/png;base64,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"},339:function(t,s,a){t.exports=a.p+"assets/img/ch5-set-time-line_2.42dc61b6.png"},663:function(t,s,a){"use strict";a.r(s);var n=a(14),r=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"_5-9-灰度发布和-a-b-test"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-9-灰度发布和-a-b-test"}},[t._v("#")]),t._v(" 5.9 灰度发布和 A/B test")]),t._v(" "),s("p",[t._v("中型的互联网公司往往有着以百万计的用户，而大型互联网公司的系统则可能要服务千万级甚至亿级的用户需求。大型系统的请求流入往往是源源不断的，任何风吹草动，都一定会有最终用户感受得到。例如你的系统在上线途中会拒绝一些上游过来的请求，而这时候依赖你的系统没有做任何容错，那么这个错误就会一直向上抛出，直到触达最终用户。形成一次对用户切切实实的伤害。这种伤害可能是在用户的 APP 上弹出一个让用户摸不着头脑的诡异字符串，用户只要刷新一下页面就可以忘记这件事。但也可能会让正在心急如焚地和几万竞争对手同时抢夺秒杀商品的用户，因为代码上的小问题，丧失掉了先发优势，与自己蹲了几个月的心仪产品失之交臂。对用户的伤害有多大，取决于你的系统对于你的用户来说有多重要。")]),t._v(" "),s("p",[t._v("不管怎么说，在大型系统中容错是重要的，能够让系统按百分比，分批次到达最终用户，也是很重要的。虽然当今的互联网公司系统，名义上会说自己上线前都经过了充分慎重严格的测试，但就算它们真得做到了，代码的 bug 总是在所难免的。即使代码没有 bug，分布式服务之间的协作也是可能出现 “逻辑” 上的非技术问题的。")]),t._v(" "),s("p",[t._v("这时候，灰度发布就显得非常重要了，灰度发布也称为金丝雀发布，传说 17 世纪的英国矿井工人发现金丝雀对瓦斯气体非常敏感，瓦斯达到一定浓度时，金丝雀即会死亡，但金丝雀的致死量瓦斯对人并不致死，因此金丝雀被用来当成他们的瓦斯检测工具。互联网系统的灰度发布一般通过两种方式实现：")]),t._v(" "),s("ol",[s("li",[t._v("通过分批次部署实现灰度发布")]),t._v(" "),s("li",[t._v("通过业务规则进行灰度发布")])]),t._v(" "),s("p",[t._v("在对系统的旧功能进行升级迭代时，第一种方式用的比较多。新功能上线时，第二种方式用的比较多。当然，对比较重要的老功能进行较大幅度的修改时，一般也会选择按业务规则来进行发布，因为直接全量开放给所有用户风险实在太大。")]),t._v(" "),s("h2",{attrs:{id:"_5-9-1-通过分批次部署实现灰度发布"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-9-1-通过分批次部署实现灰度发布"}},[t._v("#")]),t._v(" 5.9.1 通过分批次部署实现灰度发布")]),t._v(" "),s("p",[t._v("假如服务部署在 15 个实例（可能是物理机，也可能是容器）上，我们把这 15 个实例分为四组，按照先后顺序，分别有 1-2-4-8 台机器，保证每次扩展时大概都是二倍的关系。")]),t._v(" "),s("p",[s("img",{attrs:{src:a(337),alt:"online group"}})]),t._v(" "),s("p",[s("em",[t._v("图 5-20 分组部署")])]),t._v(" "),s("p",[t._v("为什么要用 2 倍？这样能够保证我们不管有多少台机器，都不会把组划分得太多。例如 1024 台机器，也就只需要 1-2-4-8-16-32-64-128-256-512 部署十次就可以全部部署完毕。")]),t._v(" "),s("p",[t._v("这样我们上线最开始影响到的用户在整体用户中占的比例也不大，比如 1000 台机器的服务，我们上线后如果出现问题，也只影响 1/1000 的用户。如果 10 组完全平均分，那一上线立刻就会影响 1/10 的用户，1/10 的业务出问题，那可能对于公司来说就已经是一场不可挽回的事故了。")]),t._v(" "),s("p",[t._v("在上线时，最有效的观察手法是查看程序的错误日志，如果较明显的逻辑错误，一般错误日志的滚动速度都会有肉眼可见的增加。这些错误也可以通过 metrics 一类的系统上报给公司内的监控系统，所以在上线过程中，也可以通过观察监控曲线，来判断是否有异常发生。")]),t._v(" "),s("p",[t._v("如果有异常情况，首先要做的自然就是回滚了。")]),t._v(" "),s("h2",{attrs:{id:"_5-9-2-通过业务规则进行灰度发布"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-9-2-通过业务规则进行灰度发布"}},[t._v("#")]),t._v(" 5.9.2 通过业务规则进行灰度发布")]),t._v(" "),s("p",[t._v("常见的灰度策略有多种，较为简单的需求，例如我们的策略是要按照千分比来发布，那么我们可以用用户 id、手机号、用户设备信息，等等，来生成一个简单的哈希值，然后再求模，用伪代码表示一下：")]),t._v(" "),s("div",{staticClass:"language-go extra-class"},[s("pre",{pre:!0,attrs:{class:"language-go"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// pass 3/1000")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("passed")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("bool")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\tkey "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("hashFunctions")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("userID"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" key "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h3",{attrs:{id:"_5-9-2-1-可选规则"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-9-2-1-可选规则"}},[t._v("#")]),t._v(" 5.9.2.1 可选规则")]),t._v(" "),s("p",[t._v("常见的灰度发布系统会有下列规则提供选择：")]),t._v(" "),s("ol",[s("li",[t._v("按城市发布")]),t._v(" "),s("li",[t._v("按概率发布")]),t._v(" "),s("li",[t._v("按百分比发布")]),t._v(" "),s("li",[t._v("按白名单发布")]),t._v(" "),s("li",[t._v("按业务线发布")]),t._v(" "),s("li",[t._v("按 UA 发布 (APP、Web、PC)")]),t._v(" "),s("li",[t._v("按分发渠道发布")])]),t._v(" "),s("p",[t._v("因为和公司的业务相关，所以城市、业务线、UA、分发渠道这些都可能会被直接编码在系统里，不过功能其实大同小异。")]),t._v(" "),s("p",[t._v("按白名单发布比较简单，功能上线时，可能我们希望只有公司内部的员工和测试人员可以访问到新功能，会直接把账号、邮箱写入到白名单，拒绝其它任何账号的访问。")]),t._v(" "),s("p",[t._v("按概率发布则是指实现一个简单的函数：")]),t._v(" "),s("div",{staticClass:"language-go extra-class"},[s("pre",{pre:!0,attrs:{class:"language-go"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("isTrue")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("bool")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v(" according to the rate provided by user\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("其可以按照用户指定的概率返回 "),s("code",[t._v("true")]),t._v(" 或者 "),s("code",[t._v("false")]),t._v("，当然，"),s("code",[t._v("true")]),t._v(" 的概率加 "),s("code",[t._v("false")]),t._v(" 的概率应该是 100%。这个函数不需要任何输入。")]),t._v(" "),s("p",[t._v("按百分比发布，是指实现下面这样的函数：")]),t._v(" "),s("div",{staticClass:"language-go extra-class"},[s("pre",{pre:!0,attrs:{class:"language-go"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("isTrue")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("phone "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("bool")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" hash of phone matches "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("这种情况可以按照指定的百分比，返回对应的 "),s("code",[t._v("true")]),t._v(" 和 "),s("code",[t._v("false")]),t._v("，和上面的单纯按照概率的区别是这里我们需要调用方提供给我们一个输入参数，我们以该输入参数作为源来计算哈希，并以哈希后的结果来求模，并返回结果。这样可以保证同一个用户的返回结果多次调用是一致的，在下面这种场景下，必须使用这种结果可预期的灰度算法，见 "),s("em",[t._v("图 5-21")]),t._v(" 所示。")]),t._v(" "),s("p",[s("img",{attrs:{src:a(338),alt:"set 和 get 流程不应该因为灰度走到不同版本的 API"}})]),t._v(" "),s("p",[s("em",[t._v("图 5-21 先 set 然后马上 get")])]),t._v(" "),s("p",[t._v("如果采用随机策略，可能会出现像 "),s("em",[t._v("图 5-22")]),t._v(" 这样的问题：")]),t._v(" "),s("p",[s("img",{attrs:{src:a(339),alt:"set 和 get 流程不应该因为灰度走到不同版本的 API"}})]),t._v(" "),s("p",[s("em",[t._v("图 5-22 先 set 然后马上 get")])]),t._v(" "),s("p",[t._v("举个具体的例子，网站的注册环节，可能有两套 API，按照用户 ID 进行灰度，分别是不同的存取逻辑。如果存储时使用了 V1 版本的 API 而获取时使用 V2 版本的 API，那么就可能出现用户注册成功后反而返回注册失败消息的诡异问题。")]),t._v(" "),s("h2",{attrs:{id:"_5-9-3-如何实现一套灰度发布系统"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-9-3-如何实现一套灰度发布系统"}},[t._v("#")]),t._v(" 5.9.3 如何实现一套灰度发布系统")]),t._v(" "),s("p",[t._v("前面也提到了，提供给用户的接口大概可以分为和业务绑定的简单灰度判断逻辑。以及输入稍微复杂一些的哈希灰度。我们来分别看看怎么实现这样的灰度系统（函数）。")]),t._v(" "),s("h3",{attrs:{id:"_5-9-3-1-业务相关的简单灰度"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-9-3-1-业务相关的简单灰度"}},[t._v("#")]),t._v(" 5.9.3.1 业务相关的简单灰度")]),t._v(" "),s("p",[t._v("公司内一般都会有公共的城市名字和 id 的映射关系，如果业务只涉及中国国内，那么城市数量不会特别多，且 id 可能都在 10000 范围以内。那么我们只要开辟一个一万大小左右的 bool 数组，就可以满足需求了：")]),t._v(" "),s("div",{staticClass:"language-go extra-class"},[s("pre",{pre:!0,attrs:{class:"language-go"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" cityID2Open "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("12000")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("bool")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("init")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("readConfig")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" i"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("i"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("len")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cityID2Open"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("i"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" city i is opened in configs "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t\tcityID2Open"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("i"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("isPassed")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cityID "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("bool")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" cityID2Open"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("cityID"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("如果公司给 cityID 赋的值比较大，那么我们可以考虑用 map 来存储映射关系，map 的查询比数组稍慢，但扩展会灵活一些：")]),t._v(" "),s("div",{staticClass:"language-go extra-class"},[s("pre",{pre:!0,attrs:{class:"language-go"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" cityID2Open "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("map")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("struct")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("init")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("readConfig")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("_")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" city "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("range")]),t._v(" openCities "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\tcityID2Open"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("city"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("struct")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("isPassed")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cityID "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("bool")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("_")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" ok "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" cityID2Open"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("cityID"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" ok "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("按白名单、按业务线、按 UA、按分发渠道发布，本质上和按城市发布是一样的，这里就不再赘述了。")]),t._v(" "),s("p",[t._v("按概率发布稍微特殊一些，不过不考虑输入实现起来也很简单：")]),t._v(" "),s("div",{staticClass:"language-go extra-class"},[s("pre",{pre:!0,attrs:{class:"language-go"}},[s("code",[t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("init")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\trand"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Seed")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("time"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Now")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("UnixNano")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// rate 为 0~100")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("isPassed")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("rate "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("bool")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" rate "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" rate "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" rand"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Int")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" rate "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("注意初始化种子。")]),t._v(" "),s("h3",{attrs:{id:"_5-9-3-2-哈希算法"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-9-3-2-哈希算法"}},[t._v("#")]),t._v(" 5.9.3.2 哈希算法")]),t._v(" "),s("p",[t._v("求哈希可用的算法非常多，比如 md5，crc32，sha1 等等，但我们这里的目的只是为了给这些数据做个映射，并不想要因为计算哈希消耗过多的 cpu，所以现在业界使用较多的算法是 murmurhash，下面是我们对这些常见的 hash 算法的简单 benchmark。")]),t._v(" "),s("p",[t._v("下面使用了标准库的 md5，sha1 和开源的 murmur3 实现来进行对比。")]),t._v(" "),s("div",{staticClass:"language-go extra-class"},[s("pre",{pre:!0,attrs:{class:"language-go"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("package")]),t._v(" main\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"crypto/md5"')]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"crypto/sha1"')]),t._v("\n\n\t"),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"github.com/spaolacci/murmur3"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" str "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"hello world"')]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("md5Hash")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("16")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("byte")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" md5"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Sum")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("byte")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("str"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sha1Hash")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("20")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("byte")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" sha1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Sum")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("byte")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("str"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("murmur32")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("uint32")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" murmur3"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Sum32")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("byte")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("str"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("murmur64")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("uint64")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" murmur3"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Sum64")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("byte")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("str"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("为这些算法写一个基准测试：")]),t._v(" "),s("div",{staticClass:"language-go extra-class"},[s("pre",{pre:!0,attrs:{class:"language-go"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("package")]),t._v(" main\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"testing"')]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("BenchmarkMD5")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("b "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("testing"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("B"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" i "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" b"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("N"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("md5Hash")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("BenchmarkSHA1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("b "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("testing"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("B"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" i "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" b"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("N"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sha1Hash")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("BenchmarkMurmurHash32")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("b "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("testing"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("B"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" i "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" b"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("N"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("murmur32")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("BenchmarkMurmurHash64")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("b "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("testing"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("B"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" i "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" b"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("N"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("murmur64")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n")])])]),s("p",[t._v("然后看看运行效果：")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("~/t/g/hash_bench git:master ❯❯❯ go "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("test")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-bench")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(".\ngoos: darwin\ngoarch: amd64\nBenchmarkMD5-4          "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10000000")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("180")]),t._v(" ns/op\nBenchmarkSHA1-4         "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10000000")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("211")]),t._v(" ns/op\nBenchmarkMurmurHash32-4 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("50000000")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("25.7")]),t._v(" ns/op\nBenchmarkMurmurHash64-4 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("20000000")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("66.2")]),t._v(" ns/op\nPASS\nok _/Users/caochunhui/test/go/hash_bench "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("7")]),t._v(".050s\n")])])]),s("p",[t._v("可见 murmurhash 相比其它的算法有三倍以上的性能提升。显然做负载均衡的话，用 murmurhash 要比 md5 和 sha1 都要好，这些年社区里还有另外一些更高效的哈希算法涌现，感兴趣的读者可以自行调研。")]),t._v(" "),s("h3",{attrs:{id:"_5-9-3-3-分布是否均匀"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-9-3-3-分布是否均匀"}},[t._v("#")]),t._v(" 5.9.3.3 分布是否均匀")]),t._v(" "),s("p",[t._v("对于哈希算法来说，除了性能方面的问题，还要考虑哈希后的值是否分布均匀。如果哈希后的值分布不均匀，那也自然就起不到均匀灰度的效果了。")]),t._v(" "),s("p",[t._v("以 murmur3 为例，我们先以 15810000000 开头，造一千万个和手机号类似的数字，然后将计算后的哈希值分十个桶，并观察计数是否均匀：")]),t._v(" "),s("div",{staticClass:"language-go extra-class"},[s("pre",{pre:!0,attrs:{class:"language-go"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("package")]),t._v(" main\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"fmt"')]),t._v("\n\n\t"),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"github.com/spaolacci/murmur3"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" bucketSize "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("main")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" bucketMap "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("map")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("uint64")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" i "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("15000000000")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("15000000000")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10000000")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\thashInt "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("murmur64")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("fmt"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Sprint")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("i"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("uint64")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("bucketSize"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t\tbucketMap"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("hashInt"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\tfmt"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Println")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("bucketMap"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("murmur64")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("p "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("uint64")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" murmur3"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Sum64")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("byte")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("p"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("看看执行结果：")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("map"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("7")]),t._v(":999475 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v(":1000359 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(":999945 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("6")]),t._v(":1000200 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v(":1000193 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("9")]),t._v(":1000765 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(":1000044 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v(":1000343 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8")]),t._v(":1000823 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(":997853"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),s("p",[t._v("偏差都在 1/100 以内，可以接受。读者在调研其它算法，并判断是否可以用来做灰度发布时，也应该从本节中提到的性能和均衡度两方面出发，对其进行考察。")])])}),[],!1,null,null,null);s.default=r.exports}}]);